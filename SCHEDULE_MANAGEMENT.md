# 授業スケジュール管理ガイド

授業スケジュールデータを簡単に追加・編集・削除する方法について説明します。

## 📋 目次

1. [管理画面へのアクセス](#管理画面へのアクセス)
2. [新規スケジュール追加](#新規スケジュール追加)
3. [スケジュールの編集](#スケジュールの編集)
4. [スケジュールの削除](#スケジュールの削除)
5. [コマンドラインからの追加](#コマンドラインからの追加)
6. [時限と時間の対応表](#時限と時間の対応表)

## 🖥️ 管理画面へのアクセス

### ⚠️ 重要: 管理者専用アクセス

管理画面は**管理者専用**です。ユーザー向けのメイン画面からはアクセスできません。

### アクセス方法

1. アプリケーションを起動します：

```bash
# バックエンド
cd backend
.\venv\Scripts\Activate.ps1
python -m api.main

# 別のターミナルでフロントエンド
pnpm dev
```

2. ブラウザで**管理画面に直接アクセス**：

```
http://localhost:8080/ynu-admin-panel-secure-9x7k2m
```

または本番環境では：

```
https://your-domain.com/ynu-admin-panel-secure-9x7k2m
```

**🔒 セキュリティ重要:**
- このURLは秘密にしてください
- 独自のURLに変更することを強く推奨（`SECURITY_ADMIN.md` 参照）
- メイン画面からはリンクがありません

### 管理画面でできること

- ✅ 授業スケジュールの一覧表示（曜日ごとにタブで表示）
- ✅ 新規スケジュールの追加
- ✅ 既存スケジュールの編集
- ✅ スケジュールの削除

## ➕ 新規スケジュール追加

### ブラウザから追加（簡単！）

1. 管理画面で「新規追加」ボタンをクリック

2. フォームに必要な情報を入力：
   - **教室** *（必須）: ドロップダウンから選択
   - **授業名** *（必須）: 例）線形代数学
   - **教員名**: 例）田中 教授
   - **曜日** *（必須）: 月〜日曜日を選択
   - **時限** *（必須）: 1〜7限を選択（時刻は自動設定）
   - **学期**: 前期/後期/通年
   - **授業コード**: 例）CS101

3. 「追加」ボタンをクリック

4. 完了！すぐに一覧に表示されます

### 入力例

```
教室: eng-a-101 (理工学部)
授業名: プログラミング基礎
教員名: 山田 教授
曜日: 月曜日
時限: 2時限 (10:30 - 12:00)
学期: 前期
授業コード: CS101
```

## ✏️ スケジュールの編集

1. 管理画面で編集したいスケジュールを探す

2. 該当スケジュールの右側にある「✏️」ボタンをクリック

3. フォームに現在の値が表示されるので、変更したい箇所を修正

4. 「更新」ボタンをクリック

5. 完了！変更が即座に反映されます

## 🗑️ スケジュールの削除

1. 管理画面で削除したいスケジュールを探す

2. 該当スケジュールの右側にある「🗑️」ボタンをクリック

3. 確認ダイアログで「OK」をクリック

4. 完了！スケジュールが削除されます

## 💻 コマンドラインからの追加

### 方法1: データベース初期化スクリプト

`backend/data/schedules.py` にサンプルデータがあります。ここに追加したいスケジュールを記述して実行：

```bash
cd backend
.\venv\Scripts\Activate.ps1
python -m utils.db_init
```

### 方法2: Pythonスクリプトで直接追加

```python
from database.session import SessionLocal
from database.models.schedule import ClassSchedule
from datetime import time

db = SessionLocal()

# 新しいスケジュールを作成
new_schedule = ClassSchedule(
    id="sched-custom-001",
    classroom_id="eng-a-101",
    class_name="人工知能基礎",
    instructor="佐藤 教授",
    day_of_week=1,  # 火曜日 (0=月, 1=火, 2=水, 3=木, 4=金, 5=土, 6=日)
    period=3,
    start_time=time(13, 0),
    end_time=time(14, 30),
    semester="前期",
    course_code="AI101",
)

db.add(new_schedule)
db.commit()
db.close()

print("スケジュールを追加しました！")
```

### 方法3: REST APIを直接使用

```bash
# POST リクエストで追加
curl -X POST "http://localhost:8000/api/v1/schedules/" \
  -H "Content-Type: application/json" \
  -d '{
    "classroom_id": "eng-a-101",
    "class_name": "機械学習",
    "instructor": "鈴木 教授",
    "day_of_week": 2,
    "period": 4,
    "start_time": "14:40:00",
    "end_time": "16:10:00",
    "semester": "後期",
    "course_code": "ML201"
  }'
```

## ⏰ 時限と時間の対応表

横浜国立大学の標準時限：

| 時限 | 開始時刻 | 終了時刻 | 時間帯 |
|------|----------|----------|--------|
| 1限 | 08:50 | 10:20 | 朝 |
| 2限 | 10:30 | 12:00 | 午前 |
| 3限 | 13:00 | 14:30 | 午後 |
| 4限 | 14:40 | 16:10 | 午後 |
| 5限 | 16:20 | 17:50 | 夕方 |
| 6限 | 18:00 | 19:30 | 夜 |
| 7限 | 19:40 | 21:10 | 夜 |

## 📊 曜日の番号

プログラムで使用する曜日の番号：

| 番号 | 曜日 |
|------|------|
| 0 | 月曜日 |
| 1 | 火曜日 |
| 2 | 水曜日 |
| 3 | 木曜日 |
| 4 | 金曜日 |
| 5 | 土曜日 |
| 6 | 日曜日 |

## 🎯 よくある質問

### Q: 同じ教室に複数の授業を登録できますか？

**A:** はい、できます。同じ教室に異なる時間帯や曜日の授業を複数登録できます。

### Q: 授業時間が重複している場合はどうなりますか？

**A:** システムは重複をチェックしませんが、最初にマッチした授業が表示されます。重複は避けることを推奨します。

### Q: スケジュールを一括で登録する方法はありますか？

**A:** はい、`backend/data/schedules.py` にデータを追加して `python -m utils.db_init` を実行するか、CSVインポート機能を使用できます（今後実装予定）。

### Q: 授業情報はすぐに反映されますか？

**A:** はい、管理画面で追加・編集・削除した内容は即座にデータベースに反映され、メインページにも反映されます。

### Q: 過去のスケジュールを削除する必要がありますか？

**A:** 必ずしも削除する必要はありません。システムは現在時刻を基準に自動的に授業中かどうかを判定します。ただし、不要なデータが増えるとパフォーマンスに影響する可能性があります。

## 🔧 トラブルシューティング

### 管理画面が表示されない

1. 正しいURLにアクセスしているか確認：`http://localhost:8080/ynu-admin-panel-secure-9x7k2m`
2. バックエンドが起動しているか確認
3. ブラウザのコンソールでエラーを確認
4. http://localhost:8000/docs でAPIが動作しているか確認

**注意**: URLを独自のものに変更した場合は、その変更後のURLを使用してください。

### スケジュールが表示されない

1. データベースに正しく保存されているか確認：
```bash
cd backend
sqlite3 ynu_classrooms.db
SELECT * FROM class_schedules;
.exit
```

2. 現在の曜日・時刻が正しいか確認

### エラーが出る

- バックエンドのログを確認：`backend/` フォルダでターミナルを確認
- フロントエンドのログを確認：ブラウザの開発者ツール（F12）のコンソールタブ

## 📝 データベースのバックアップ

重要なスケジュールデータを保護するため、定期的にバックアップを取ることをお勧めします：

```bash
# データベースファイルをコピー
cd backend
cp ynu_classrooms.db ynu_classrooms_backup_$(date +%Y%m%d).db
```

## 🚀 次のステップ

- CSVファイルからの一括インポート機能（開発予定）
- スケジュールのエクスポート機能
- 学期ごとのスケジュール管理
- 教室の予約機能

---

**ヘルプが必要な場合は、開発チームにお問い合わせください。**

